# Чат с GigaChat

## Обзор

Реализован полноценный чат с GigaChat, который позволяет пользователям:

1. Общаться с AI-ассистентом по вопросам ораторского искусства
2. Задавать уточняющие вопросы по результатам анализа речи
3. Получать персонализированные рекомендации по улучшению навыков публичных выступлений

## Возможности

### 1. Общий чат
- Задавайте любые вопросы по ораторскому искусству
- Получайте советы по структуре речи, стилю выступления, взаимодействию с аудиторией
- Используйте контекстное общение с поддержкой истории сообщений

### 2. Чат по результатам анализа
- Обсуждайте конкретные аспекты вашего выступления
- Получайте детализированные рекомендации по улучшению выявленных проблем
- Используйте привязку к конкретным моментам времени в выступлении (в будущем)

### 3. Веб-интерфейс
- Удобный интерфейс для общения с GigaChat
- Возможность настройки параметров (температура, количество токенов)
- Простота использования для конечных пользователей

## Архитектура

### Файлы

- `app/api/routes/chat.py` - маршруты для чата
- `app/templates/chat.html` - веб-интерфейс чата
- `CHAT_API.md` - документация по API

### Маршруты

- `GET /chat/ui` - веб-интерфейс чата
- `POST /chat` - общий чат с GigaChat
- `POST /chat/analyze-followup` - чат по результатам анализа

## Использование

После запуска приложения:

1. Откройте веб-интерфейс: `http://localhost:8000/chat/ui`
2. Или используйте API напрямую:
   ```bash
   curl -X POST "http://localhost:8000/chat" \
     -H "Content-Type: application/json" \
     -d '{
       "messages": [
         {
           "role": "user",
           "content": "Как мне улучшить структуру моего выступления?"
         }
       ]
     }'
   ```

## Интеграция с основным приложением

- Маршрут автоматически зарегистрирован в основном приложении
- Использует тот же GigaChat клиент, что и основной анализ
- Поддерживает все настройки аутентификации и конфигурации

## Технические особенности

- Обработка ошибок GigaChat API
- Проверка настроек и доступности сервиса
- Поддержка истории сообщений
- Настройка параметров модели (температура, количество токенов)
- Защита от некорректных запросов
- Автоматическая проверка и обновление токена аутентификации перед каждым запросом к GigaChat API
- Исправлена проблема с 401 ошибкой при несвоевременном обновлении токена