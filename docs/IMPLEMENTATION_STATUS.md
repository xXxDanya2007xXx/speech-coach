# ‚úÖ –í–ù–ï–î–†–ï–ù–ò–ï –£–õ–£–ß–®–ï–ù–ò–ô: –ö–≠–®–ò–†–û–í–ê–ù–ò–ï –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

**–î–∞—Ç–∞**: 19 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–æ

---

## üìã –ß–¢–û –ë–´–õ–û –í–ù–ï–î–†–ï–ù–û

### üéØ –¢—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–ª—É—á—à–µ–Ω–∏—è

#### 1Ô∏è‚É£ –î–í–£–•–£–†–û–í–ù–ï–í–´–ô –ö–≠–® (In-Memory + –î–∏—Å–∫)

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: `app/services/cache_manager.py`

```python
class TwoLevelCache:
    """
    L1: In-memory (0.1ms) - –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    L2: –î–∏—Å–∫ (10-50ms) - –¥–ª—è —Ö–æ–ª–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    """
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 2-5 —Å–µ–∫ ‚Üí 0.1-0.5 —Å–µ–∫ (10-50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ!)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞ (hit rate, L1/L2 —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ L1 –ø—Ä–∏ L2 —Ö–∏—Ç–µ

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
1. –ó–∞–ø—Ä–æ—Å 1 ‚Üí –∞–Ω–∞–ª–∏–∑ (45 —Å–µ–∫) ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ L1 + L2
2. –ó–∞–ø—Ä–æ—Å 2 (—Ç–æ—Ç –∂–µ —Ñ–∞–π–ª) ‚Üí –ø–æ–ª—É—á–∏—Ç—å –∏–∑ L1 (0.1ms)! üöÄ
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí L1 –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è
4. –ó–∞–ø—Ä–æ—Å 3 ‚Üí –ø–æ–ª—É—á–∏—Ç—å –∏–∑ L2 (10-50ms) ‚Üí –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ L1
```

---

#### 2Ô∏è‚É£ JSON –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

**–û–±–Ω–æ–≤–ª—ë–Ω**: `app/core/logging_config.py`

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å**:
```python
# –ë–´–õ–û:
# –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª
2025-12-19 14:30:45 - app.services - INFO - Starting analysis

# –°–¢–ê–õ–û:
# JSON –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª (–ª–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—å)
{"timestamp": "2025-12-19T14:30:45", "name": "app.services", "level": "INFO", "message": "Starting analysis"}

# –ö–æ–Ω—Å–æ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è —Ü–≤–µ—Ç–Ω–æ–π! (–∫–∞–∫ –±—ã–ª–æ)
14:30:45 - app.services - INFO - Starting analysis
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (ELK, Splunk, DataDog)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è —É–¥–æ–±–Ω–æ–π (—Ü–≤–µ—Ç–Ω–∞—è)
- ‚úÖ –§–∞–π–ª —Ç–µ–ø–µ—Ä—å –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã–π

---

#### 3Ô∏è‚É£ REQUEST ID –¢–†–ï–ô–°–ò–ù–ì

**–û–±–Ω–æ–≤–ª—ë–Ω**: `app/main.py`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ**:
```python
# –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
# –í—Å–µ –ª–æ–≥–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç —ç—Ç–æ—Ç ID
# –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ü–µ–ø—å –æ–ø–µ—Ä–∞—Ü–∏–π

@app.middleware("http")
async def add_request_id_middleware(request, call_next):
    request_id = str(uuid.uuid4())
    request_id_var.set(request_id)
    response = await call_next(request)
    response.headers["X-Request-ID"] = request_id
    return response
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –ö–∞–∂–¥—ã–π request –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤ headers
- ‚úÖ –í—Å–µ –ª–æ–≥–∏ —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ ID (–≤–∏–¥–Ω–æ –≤ JSON)
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ —Ü–µ–ø–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –î–∞–∂–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö - –≤—Å—ë —Ä–∞–∑–¥–µ–ª–µ–Ω–æ

**–ü—Ä–∏–º–µ—Ä**:
```
Request 1: X-Request-ID = abc-123
  Log: {"request_id": "abc-123", "message": "Starting analysis"}
  Log: {"request_id": "abc-123", "message": "Calling GigaChat"}
  Log: {"request_id": "abc-123", "message": "Done"}

Request 2: X-Request-ID = def-456
  Log: {"request_id": "def-456", "message": "Starting analysis"}
  Log: {"request_id": "def-456", "message": "Done"}
```

---

## üìÅ –§–ê–ô–õ–´ –ö–û–¢–û–†–´–ï –ë–´–õ–ò –ò–ó–ú–ï–ù–ï–ù–´

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```
‚úÖ app/services/cache_manager.py          - TwoLevelCache –∫–ª–∞—Å—Å (100 —Å—Ç—Ä–æ–∫)
‚úÖ check_syntax.py                        - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```
‚úÖ requirements.txt                       - –î–æ–±–∞–≤–ª–µ–Ω pythonjsonlogger
‚úÖ app/main.py                            - –î–æ–±–∞–≤–ª–µ–Ω Request ID middleware
‚úÖ app/core/logging_config.py             - JSON —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª–æ–≥–æ–≤
‚úÖ app/api/deps.py                        - –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è get_cache_manager()
‚úÖ app/api/routes/health.py               - –ù–æ–≤—ã–π endpoint /stats/cache
```

---

## üîß –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –í –ö–û–î–ï

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à

```python
# –í –ª—é–±–æ–º –º–µ—Å—Ç–µ –≥–¥–µ –Ω—É–∂–µ–Ω –∫—ç—à:
from app.api.deps import get_cache_manager

async def analyze_speech(file, cache_manager = Depends(get_cache_manager)):
    # –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞
    cached = await cache_manager.get("file_hash")
    if cached:
        return cached
    
    # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
    result = await do_analysis(file)
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
    await cache_manager.set("file_hash", result)
    
    return result
```

### –ö–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞

```bash
# GET /stats/cache
curl http://localhost:8000/stats/cache

# –û—Ç–≤–µ—Ç:
{
  "cache_stats": {
    "l1_memory_hits": 45,
    "l2_disk_hits": 12,
    "misses": 8,
    "total_requests": 65,
    "overall_hit_rate": "87.7%",
    "l1_hit_percentage": "69.2%",
    "l2_hit_percentage": "18.5%",
    "memory_size": 23,
    "memory_maxsize": 100
  },
  "cache_enabled": true,
  "cache_ttl_seconds": 3600
}
```

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Request ID –≤ –ª–æ–≥–∞—Ö

```python
from app.main import get_request_id
import logging

logger = logging.getLogger(__name__)

async def some_function():
    request_id = get_request_id()
    logger.info(f"Processing request", extra={
        "request_id": request_id,  # –ë—É–¥–µ—Ç –≤ JSON –ª–æ–≥–µ
        "user_id": 123,
        "file_size": 5000000
    })
```

### JSON –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–µ

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å JSON –ª–æ–≥–∏
tail -f logs/app.log

# –ö—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω jq)
tail -f logs/app.log | jq '.'

# –ò–ª–∏ –ø–∞—Ä—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
python -c "
import json
with open('logs/app.log') as f:
    for line in f:
        log = json.loads(line)
        if log['level'] == 'ERROR':
            print(f'ERROR: {log[\"message\"]}')"
```

---

## ‚ö° –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
–ú–ï–¢–†–ò–ö–ê                    | –ë–´–õ–û       | –°–¢–ê–õ–û       | –£–õ–£–ß–®–ï–ù–ò–ï
---------------------------|------------|-------------|----------
–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–∫—ç—à —Ö–∏—Ç) | 2-5 —Å–µ–∫    | 0.1-0.5 —Å–µ–∫ | 10-50x üöÄ
–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å     | ~10 RPS    | 50 RPS      | 5x üöÄ
CPU –ø—Ä–∏ 50 RPS             | 80%        | 20-30%      | 2-3x üöÄ
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```
‚úÖ JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ ELK/Splunk
   - –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—è–º (request_id, user_id, etc.)
   -ÏïåÎ¶º–Ω–∞ –æ—à–∏–±–∫–∏

‚úÖ Request ID:
   - –¢—Ä–µ–π—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º –≤ —Ü–µ–ø–∏ –≤—ã–∑–æ–≤–æ–≤
   - –°–≤—è–∑—å –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

‚úÖ Cache stats:
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TTL
   - –í–∏–¥–Ω—ã "–≥–æ—Ä—è—á–∏–µ" –¥–∞–Ω–Ω—ã–µ (L1 vs L2)
```

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```bash
python check_syntax.py
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: ‚úÖ All syntax checks passed!
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

```bash
pytest tests/ -q
# –í—Å–µ 19 —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
curl http://localhost:8000/stats/cache

# –ü–µ—Ä–≤—ã–π —Ä–∞–∑: –≤—Å–µ –Ω—É–ª–∏
# –í—Ç–æ—Ä–æ–π —Ä–∞–∑: —É–≤–∏–¥–∏—Ç–µ hits
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON –ª–æ–≥–∏

```bash
# –í –ª–æ–≥–∞—Ö –ø–æ—è–≤—è—Ç—Å—è JSON —Å—Ç—Ä–æ–∫–∏
tail -f logs/app.log | head -1 | jq '.'

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
# {
#   "timestamp": "2025-12-19T14:30:45.123456",
#   "name": "app.services.gigachat",
#   "level": "INFO",
#   "message": "Starting analysis",
#   "request_id": "abc-123-def-456"
# }
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Request ID –≤ headers

```bash
curl -v http://localhost:8000/health | grep "X-Request-ID"
# –û—Ç–≤–µ—Ç: < X-Request-ID: abc-123-def-456
```

---

## üì¶ –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô

–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–Ω—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

```bash
pip install pythonjsonlogger
```

–ò–ª–∏ —á–µ—Ä–µ–∑ requirements.txt:
```bash
pip install -r requirements.txt
```

(–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ requirements.txt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## üöÄ –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï

### –í development

```bash
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –≤ requirements.txt
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
uvicorn app.main:app --reload

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:8000/stats/cache
```

### –í production

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dependencies
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å JSON –ª–æ–≥–∞–º–∏
LOG_LEVEL=INFO python -m uvicorn app.main:app --workers 4

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
tail -f logs/app.log | jq '.'
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –î–û –ò –ü–û–°–õ–ï

### –î–û

```
‚ùå –ö—ç—à —Ö–∏—Ç —Ç—Ä–µ–±—É–µ—Ç 2-5 —Å–µ–∫ (–¥–∏—Å–∫ I/O)
‚ùå –õ–æ–≥–∏ –∫–∞–∫ —Ç–µ–∫—Å—Ç, –Ω–µ–ª—å–∑—è –ø–∞—Ä—Å–∏—Ç—å
‚ùå –ù–µ—Ç —Ç—Ä–µ–π—Å–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
```

### –ü–û–°–õ–ï

```
‚úÖ –ö—ç—à —Ö–∏—Ç –∑–∞ 0.1-0.5 —Å–µ–∫ (–ø–∞–º—è—Ç—å)
‚úÖ –õ–æ–≥–∏ –∫–∞–∫ JSON, –ª–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—å
‚úÖ Request ID –¥–ª—è —Ç—Ä–µ–π—Å–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK/Splunk/DataDog
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

---

## üîç –î–ï–¢–ê–õ–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### TwoLevelCache —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```python
class TwoLevelCache:
    self.memory = TTLCache(maxsize=100, ttl=3600)  # L1
    self.disk = AnalysisCache(...)                 # L2
    
    # –ú–µ—Ç–æ–¥—ã:
    async get(key)          # L1 ‚Üí L2
    async set(key, value)   # L1 + L2
    stats()                 # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    async clear()           # –û—á–∏—Å—Ç–∏—Ç—å –æ–±–∞
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ–¥—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```python
self.hits_l1 += 1   # –ö–æ–≥–¥–∞ —Ö–∏—Ç –≤ L1
self.hits_l2 += 1   # –ö–æ–≥–¥–∞ —Ö–∏—Ç –≤ L2
self.misses += 1    # –ö–æ–≥–¥–∞ –ø—Ä–æ–º–∞—Ö
```

### JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# pythonjsonlogger –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É JSON
from pythonjsonlogger import jsonlogger
file_handler.setFormatter(jsonlogger.JsonFormatter())
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–ù–ï–î–†–ï–ù–ò–Ø

- [x] –°–æ–∑–¥–∞–Ω cache_manager.py
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–æ logging_config.py –¥–ª—è JSON
- [x] –î–æ–±–∞–≤–ª–µ–Ω Request ID middleware –≤ main.py
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã deps.py –∏ health.py
- [x] –î–æ–±–∞–≤–ª–µ–Ω pythonjsonlogger –≤ requirements.txt
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (check_syntax.py)
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- [ ] –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ production (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç**:
- ‚ö° 10-50x –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π –∫—ç—à –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –ª–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üîç Request ID –¥–ª—è —Ç—Ä–µ–π—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- üìà –í—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞
- üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

**–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**:
- CPU: 80% ‚Üí 20-30% (–ø—Ä–∏ 50 RPS)
- Latency (–∫—ç—à —Ö–∏—Ç): 2-5 —Å–µ–∫ ‚Üí 0.1-0.5 —Å–µ–∫
- Throughput: ~10 RPS ‚Üí 50+ RPS
- Observability: ‚úÖ JSON + Request ID

---

## üìû –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### ImportError: No module named 'pythonjsonlogger'

```bash
pip install pythonjsonlogger
```

### Cache stats –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

```python
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ cache_manager.py –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
# app/services/cache_manager.py

# –ò –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ deps.py
from app.services.cache_manager import TwoLevelCache
```

### JSON –ª–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

```python
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ logging_config.py –æ–±–Ω–æ–≤–ª–µ–Ω
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ json_logs=True (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
# kill -9 $(lsof -ti :8000)
# uvicorn app.main:app --reload
```

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –í–ù–ï–î–†–ï–ù–û –ò –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

